<?xml version="1.0"?>
<cruisecontrol>
	<property file="config.properties"/>
	<property file="views.properties"/>

	<!-- Projects -->
	<project name="StrobeNightly">
		<labelincrementer 
			port="${p4port}" 
			client="${strobe.p4client}" 
			user="${p4user}" 
			passwd="${p4password}" 
			view="${strobe.p4view}"/>
	<!--
	Listeners are notified of project events e.g. build in progress, which are
	used by the CruiseControl console.
	-->
		<listeners>
			<currentbuildstatuslistener file="logs/${project.name}/status.txt"/>
		</listeners>
	<!--
	Bootstrappers are run every time the build runs, *before* the modification checks.
       	-->
		<bootstrappers>
			<p4bootstrapper 
				port="${p4port}" 
				client="${strobe.p4client}" 
				user="${p4user}" 
				passwd="${p4password}" 
				view="${strobe.p4view}"/>
		</bootstrappers>
	<!--
	Defines where CruiseControl looks for changes, to decide whether to run the build.
	-->
		<modificationset quietperiod="10">
			<p4 
				correctForServerTime="true" 
				port="${p4port}" 
				client="${strobe.p4client}" 
				user="${p4user}" 
				passwd="${p4password}" 
				view="${strobe.p4view}"/>
		</modificationset>
	<!--
	Configures the actual build loop, how often and which build file/target.
	-->
		<schedule>
			<ant time="0930" 
				anthome="${ant.home}" 
				buildfile="${strobe.dir}/build.xml" 
				target="cruisecontrol.nightly" 
				uselogger="true" 
				usedebug="false">
				
				<property name="projectname" value="${project.name}"/>
				<property name="build.type" value="NIGHTLY"/>
			</ant>
		</schedule>
	<!--
	Directory to write build logs to.
	-->
		<log>
			<merge dir="${strobe.dir}/report"/>
		</log>
	<!--
	Publishers are run *after* a build completes.
	-->
		<publishers>
			<onfailure>
				<antpublisher 
					anthome="${ant.home}" 
					buildfile="${strobe.dir}/build.xml" 
					uselogger="true" 
					usedebug="false" 
					target="notify.failure">
					<property name="build.type" value="NIGHTLY"/>
				</antpublisher>
			</onfailure>
		</publishers>
	</project>

	<project name="StrobeIntegration">
		<labelincrementer 
			port="${p4port}" 
			client="${strobe.p4client}" 
			user="${p4user}" 
			passwd="${p4password}" 
			view="${strobe.p4view}"/>
	<!--
	Listeners are notified of project events e.g. build in progress, which are
	used by the CruiseControl console.
	-->
		<listeners>
			<currentbuildstatuslistener file="logs/${project.name}/status.txt"/>
		</listeners>
	<!--
	Bootstrappers are run every time the build runs, *before* the modification checks.
    -->
		<bootstrappers>
			<p4bootstrapper 
				port="${p4port}" 
				client="${strobe.p4client}" 
				user="${p4user}" 
				passwd="${p4password}" 
				view="${strobe.p4view}"/>
		</bootstrappers>
	<!--
	Defines where CruiseControl looks for changes, to decide whether to run the build.
	-->
		<modificationset quietperiod="10">
			<p4 correctForServerTime="true" 
				port="${p4port}" 
				client="${strobe.p4client}" 
				user="${p4user}" 
				passwd="${p4password}" 
				view="${strobe.p4view}"/>
		</modificationset>
	<!--
	Configures the actual build loop, how often and which build file/target.
	-->
		<schedule interval="300">
			<ant anthome="${ant.home}" 
				buildfile="${strobe.dir}/build.xml" 
				target="cruisecontrol.integration" 
				uselogger="true" 
				usedebug="false">
				
				<property name="projectname" value="${project.name}"/>
				<property name="build.type" value="INTEGRATION"/>
			</ant>
			<!-- <pause  starttime="0900" endtime="1000"/>-->
		</schedule>
	<!--
	Directory to write build logs to.
	-->
		<log>
			<merge dir="${strobe.dir}/report"/>
		</log>
	<!--
	Publishers are run *after* a build completes.
	-->
		<publishers>
			<onfailure>
				<antpublisher 
					anthome="${ant.home}" 
					buildfile="${strobe.dir}/build.xml" 
					uselogger="true" 
					usedebug="false" 
					target="notify.failure">
					
					<property name="build.type" value="INTEGRATION"/>
				</antpublisher>
			</onfailure>
		</publishers>
	</project>

</cruisecontrol>
